# 3.3 Hybrid Retrieval (Keywords + Meaning)

### Introduction
Vector search is like "searching by vibe"â€”it's great for concepts but bad for exact matches. Hybrid search adds "searching by string," combining the intuition of Vectors with the precision of Keywords.

### Objective
Learn how to use "Ensemble Retrievers" to combine BM25 and Vector search, solving the "Noisy retrieval" problem in production RAG.

### Concept
- **Keyword Search (BM25):** The "old school" way. It looks for exact occurrences of words like "SKU-4921". 
- **Vector Search:** The "new school" way. It looks for the $concept$ of a product.
- **Ensemble:** A LangChain object that runs both searches and merges the results. It ensures that if a user search for a specific ID, that document stays at the top.

### Example
```python
from langchain.retrievers import EnsembleRetriever
from langchain_community.retrievers import BM25Retriever

# 1. Keyword-based retriever
bm25_retriever = BM25Retriever.from_texts(["Report 1: SKU-99", "Report 2: Project X"])

# 2. Meaning-based retriever
# vector_retriever = ... (from previous lesson)

# 3. Combine them (50/50 balance)
ensemble_retriever = EnsembleRetriever(
    retrievers=[bm25_retriever, vector_retriever],
    weights=[0.5, 0.5]
)
```

### 2 Use Cases
1. **Medical Record Search:** Finding a patient by their "Policy ID" (Keyword) while also finding their "Diagnosis history" (Vector).
2. **DevOps Manuals:** Searching for a specific "Error Code: 0x800" vs general "Installation issues".

### Real-World RAG & Agentic Context
In **Real-World RAG**, Hybrid Search is often the difference between a system that "sort of works" and one that is "enterprise-grade". Users get frustrated when a vector search finds a "vibe-related" document but ignores the one document that contains their exact part number.
In **Agentic Systems**, hybrid search is critical for **"Grounding Accuracy"**. If an agent is told to "Update the status of project Ithilien," it needs an exact keyword match. If it uses a vector-only search and finds "The Shire Project" (because it has a similar 'vibe'), the agent might perform the action on the wrong data! Hybrid search prevents these "Agentic Accidents".

### Did you know?
Hybrid search often uses an algorithm called **RRF (Reciprocal Rank Fusion)**. It doesn't look at the raw "scores" of each search (which are on different scales). Instead, it looks at the *rank* (1st, 2nd, 3rd) and averages the ranks to find the true winner.
